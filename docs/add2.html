<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UNPIE2 – Add 2</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script type="module" src="https://webr.r-wasm.org/latest/webr.mjs"></script>

<style>
  html,body{height:100%;margin:0}
  body{overflow:hidden;font-family:system-ui,Segoe UI,Arial,sans-serif;background:#fff;color:#111}
  .app{height:640px;display:grid;place-items:stretch}
  .wrap{max-width:1150px;margin:0 auto;padding:8px 12px;height:100%;box-sizing:border-box}
  .title{text-align:center;margin:4px 0 6px;font-size:1.15rem}
  .subtitle{text-align:center;margin-bottom:6px;color:#666}
  .grid{display:grid;grid-template-columns:340px 1fr;gap:12px;height:calc(100% - 52px)}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .panel{border:1px solid #e8e8e8;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04);background:#fff}
  .left{padding:10px;overflow:auto}
  .group{border:1px solid #ddd;border-radius:10px;padding:10px;margin-bottom:10px}
  .group h3{margin:0 0 8px;font-size:1rem}
  .row{display:flex;align-items:center;gap:.8rem}
  .row + .row{margin-top:8px}
  .val{width:7rem;text-align:right;color:#666;font-variant-numeric:tabular-nums}
  input[type=range]{width:100%}
  button{padding:.55rem .9rem;border:0;border-radius:10px;background:#eee;cursor:pointer}
  .right{padding:10px;display:flex;flex-direction:column;height:100%;overflow:hidden}
  .badge{display:inline-block;background:#f7f7f9;border-radius:10px;padding:.45rem .7rem;margin-left:.5rem;font-variant-numeric:tabular-nums}
  .chartWrap{flex:1 0 auto;height:360px}
  #line{width:100%;height:100%}
  .kpi{margin-top:6px;text-align:center}
  .kpiTable { border-collapse: separate; border-spacing: 6px; margin: 0 auto; }
  .kpiTable th, .kpiTable td {
    background:#f7f7f9; padding:.45rem .6rem; border-radius:8px;
    font-variant-numeric: tabular-nums; text-align: right; white-space: nowrap;
  }
  .kpiTable th.label { background:#ebedf0; color:#333; text-align:left; }
  .debug{margin-top:6px;background:#f7f7f9;border-radius:10px;padding:6px;overflow:auto;flex:0 0 110px;display:none}
  pre{margin:0;font-size:.82rem}
</style>
</head>
<body>
<div class="app">
  <div class="wrap">
    <div class="title" id="title">App 11: Real yearly savings required to reach minimum desired (real) yearly pension with probability p</div>
    <div class="subtitle">
      <span id="subtitleText">Required yearly savings (real)</span>
      <span class="badge" id="savingsBadge">—</span>
    </div>

    <div class="grid">
      <!-- Controls -->
      <div class="panel left">
        <div class="group">
          <h3 id="gPmin">Minimum desired yearly pension (real)</h3>
          <div class="row">
            <label for="pmin" style="flex:1" id="lPmin">Pension per year</label>
            <input id="pmin" type="range" min="300" max="60000" step="50" value="1000">
            <div class="val" id="pminLabel">1,000</div>
          </div>
        </div>

        <div class="group">
          <h3 id="gNper">Time horizon (years to retirement)</h3>
          <div class="row">
            <label for="nper" style="flex:1" id="lNper">Years</label>
            <input id="nper" type="range" min="5" max="45" step="1" value="35">
            <div class="val" id="nperLabel">35</div>
          </div>
        </div>

        <div class="group">
          <h3 id="gProb">Probability to reach minimum desired yearly pension (real)</h3>
          <div class="row">
            <label for="prob" style="flex:1" id="lProb">Probability</label>
            <input id="prob" type="range" min="0.50" max="0.99" step="0.005" value="0.80">
            <div class="val" id="probLabel">80.00%</div>
          </div>
        </div>

        <div class="group">
          <h3 id="gMu">Expected (real) return</h3>
          <div class="row">
            <label for="mu" style="flex:1" id="lMu">Expected return</label>
            <input id="mu" type="range" min="0" max="0.10" step="0.0005" value="0.03">
            <div class="val" id="muLabel">3.00%</div>
          </div>
        </div>

        <div class="group">
          <h3 id="gVol">Volatility of expected (real) return</h3>
          <div class="row">
            <label for="vol" style="flex:1" id="lVol">Volatility</label>
            <input id="vol" type="range" min="0" max="0.30" step="0.0005" value="0.08">
            <div class="val" id="volLabel">8.00%</div>
          </div>
        </div>

        <div class="group">
          <h3 id="gConv">Conversion rate</h3>
          <div class="row">
            <label for="conv" style="flex:1" id="lConv">Rate</label>
            <input id="conv" type="range" min="0.02" max="0.08" step="0.0005" value="0.05">
            <div class="val" id="convLabel">5.00%</div>
          </div>
        </div>

        <button id="compute">Recalculate</button>
      </div>

      <!-- Chart & KPIs -->
      <div class="panel right">
        <div class="chartWrap"><canvas id="line"></canvas></div>

        <div class="kpi">
          <table class="kpiTable" id="kpiTableAdd2">
            <tr id="add2RowWealth">
              <th class="label" id="kWealthHdr">Future value of savings (real):</th>
              <!-- 10 values inserted by JS -->
